#!/usr/bin/env bash
# driftw - Drift wrapper for IDE builds (macOS/Linux only)
# Locates drift CLI and runs it with provided arguments

set -e

# Try drift on current PATH
resolved=$(command -v drift 2>/dev/null || true)
[[ -x "$resolved" ]] && exec "$resolved" "$@"

# Check well-known locations
for candidate in \
    "${GOBIN:+$GOBIN/drift}" \
    "${GOPATH:+$GOPATH/bin/drift}" \
    "$HOME/go/bin/drift" \
    "$HOME/.local/bin/drift" \
    "/usr/local/bin/drift" \
    "/opt/homebrew/bin/drift"; do
    [[ -x "$candidate" ]] && exec "$candidate" "$@"
done

# macOS: use path_helper to reconstruct system PATH (Homebrew, Go installer, etc.)
if [[ -x /usr/libexec/path_helper ]]; then
    eval "$(/usr/libexec/path_helper -s)"
    resolved=$(command -v drift 2>/dev/null || true)
    [[ -x "$resolved" ]] && exec "$resolved" "$@"
fi

# Last resort: replicate the user's terminal environment via login shell
if [[ -n "$SHELL" ]]; then
    drift_path=$("$SHELL" -l -c 'command -v drift 2>/dev/null' 2>/dev/null) || true
    [[ -x "$drift_path" ]] && exec "$drift_path" "$@"
fi

echo "Error: drift not found." >&2
echo "Install with: go install github.com/go-drift/drift/cmd/drift@latest" >&2
exit 1
